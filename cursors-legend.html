<!DOCTYPE html>
<html lang="en">

<head>
    <title>Flot Examples: Cursors and Cursor Legend</title>
    <link rel="stylesheet" href="jqwidgets/jqx.base.css" type="text/css" />
    <link href="example.css" rel="stylesheet" type="text/css">

    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxdata.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxmenu.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxgrid.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxgrid.selection.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxnumberinput.js"></script>
    <script type="text/javascript" src="jqwidgets/jqxwindow.js"></script>

    <script language="javascript" type="text/javascript" src="jquery.flot.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.symbol.js"></script>
    <script language="javascript" type="text/javascript" src="jquery.flot.cursors.js"></script>
    <script type="text/javascript" type="text/javascript" src="cursors-legend.js"></script>

    <script type="text/javascript">
        var initLegend = function () {
            var cursorCounter = 1;
            var cursorColors = ['', 'navy', 'magenta', 'indigo', 'GoldenRod', 'pink', 'salmon']

            var plot = window.myPlot;
            // prepare the data

            var data = [];

            plot.getCursors().forEach(function (cursor) {
                data.push({
                    cursorname: cursor.name,
                    x: 0,
                    y: 0
                });
            });

            var source = {
                localdata: data,
                datatype: "array",
                datafields: [
                    {
                        name: 'cursorname',
                        type: 'string'
                    },
                    {
                        name: 'x',
                        type: 'number'
                    },
                    {
                        name: 'y',
                        type: 'number'
                    }
                        ],
                updaterow: function (rowid, rowdata, commit) {
                    // synchronize with the server - send update command
                    // call commit with parameter true if the synchronization with the server is successful 
                    // and with parameter false if the synchronization failed.
                    var name = plot.getCursors()[rowid].name;

                    if (rowdata.cursorname != name)
                        plot.setCursor(plot.getCursors()[rowid], {
                            name: rowdata.cursorname
                        });

                    commit(true);
                },
                deleterow: function (rowid, commit) {
                    // synchronize with the server - send delete command
                    // call commit with parameter true if the synchronization with the server is successful 
                    // and with parameter false if the synchronization failed.
                    plot.removeCursor(plot.getCursors()[rowid]);
                    commit(true);
                },
                addrow: function (rowid, rowdata, position, commit) {
                    // synchronize with the server - send delete command
                    // call commit with parameter true if the synchronization with the server is successful 
                    // and with parameter false if the synchronization failed.
                    plot.addCursor({
                        position: {
                            relativeX: rowdata.x,
                            relativeY: rowdata.y
                        },
                        showLabel: true,
                        color: rowdata.color
                    });
                    commit(true);
                }
            };

            // initialize the input fields.
            $("#cursorname").addClass('jqx-input');
            $("#cursorname").width(250);
            $("#cursorname").height(23);

            var dataAdapter = new $.jqx.dataAdapter(source);
            var editrow = -1;

            // initialize jqxGrid
            $("#jqxgrid").jqxGrid({
                width: 400,
                height: 120,
                source: dataAdapter,
                autoheight: false,
                columns: [
                    {
                        text: 'Cursor Name',
                        datafield: 'cursorname',
                        width: 200
                    },
                    {
                        text: 'X',
                        datafield: 'x',
                        width: 100,
                        cellsalign: 'left',
                        cellsformat: 'f4'
                    },
                    {
                        text: 'Y',
                        datafield: 'y',
                        cellsalign: 'left',
                        cellsformat: 'f4'
                    }
                ]
            });

            // create context menu
            var contextMenu = $("#Menu").jqxMenu({
                width: 200,
                height: 81,
                autoOpenPopup: false,
                mode: 'popup'
            });

            $("#jqxgrid").on('contextmenu', function () {
                return false;
            });

            // handle context menu clicks.
            $("#Menu").on('itemclick', function (event) {
                var args = event.args;
                var rowindex = $("#jqxgrid").jqxGrid('getselectedrowindex');
                if ($.trim($(args).text()) == "Edit Selected Cursor") {
                    editrow = rowindex;
                    var offset = $("#jqxgrid").offset();
                    $("#popupWindow").jqxWindow({
                        position: {
                            x: parseInt(offset.left) + 60,
                            y: parseInt(offset.top) + 60
                        }
                    });

                    // get the clicked row's data and initialize the input fields.
                    var dataRecord = $("#jqxgrid").jqxGrid('getrowdata', editrow);
                    $("#cursorname").val(dataRecord.cursorname);
                    /*
                    $("#x").jqxNumberInput({
                        decimal: dataRecord.x
                    });
                    $("#y").jqxNumberInput({
                        decimal: dataRecord.y
                    });
                    */
                    // show the popup window.
                    $("#popupWindow").jqxWindow('show');
                } else if ($.trim($(args).text()) == "Add Cursor") {
                    $("#jqxgrid").jqxGrid('addrow', null, {
                        cursorname: 'Cursor ' + cursorCounter,
                        x: 33 + cursorCounter * 10,
                        y: 44 + cursorCounter * 10,
                        color: cursorColors[cursorCounter++]
                    });
                } else {
                    var rowid = $("#jqxgrid").jqxGrid('getrowid', rowindex);
                    $("#jqxgrid").jqxGrid('deleterow', rowid);
                }
            });

            $("#jqxgrid").on('rowclick', function (event) {
                if (event.args.rightclick) {
                    $("#jqxgrid").jqxGrid('selectrow', event.args.rowindex);
                    var scrollTop = $(window).scrollTop();
                    var scrollLeft = $(window).scrollLeft();
                    contextMenu.jqxMenu('open', parseInt(event.args.originalEvent.clientX) + 5 + scrollLeft, parseInt(event.args.originalEvent.clientY) + 5 + scrollTop);

                    return false;
                }
            });

            // initialize the popup window and buttons.
            $("#popupWindow").jqxWindow({
                width: 400,
                resizable: false,
                isModal: true,
                autoOpen: false,
                cancelButton: $("#Cancel"),
                modalOpacity: 0.01
            });
            $("#Cancel").jqxButton({});
            $("#Save").jqxButton({});

            // update the edited row when the user clicks the 'Save' button.
            $("#Save").click(function () {
                if (editrow >= 0) {
                    var row = $("#jqxgrid").jqxGrid('getrowdata', editrow);
                    row.cursorname = $("#cursorname").val();
                    var rowid = $("#jqxgrid").jqxGrid('getrowid', editrow);
                    $('#jqxgrid').jqxGrid('updaterow', rowid, row);
                    $("#popupWindow").jqxWindow('hide');
                }
            });

            $("#placeholder").bind("cursorupdates", function (event, cursordata) {
                var i = 0;
                cursordata.forEach(function (cursor) {
                    var row = $("#jqxgrid").jqxGrid('getrowdata', i);
                    if (row) {
                        row.x = cursor.x;
                        row.y = cursor.y;
                        $('#jqxgrid').jqxGrid('updaterow', i, row);
                    }
                    i++;
                });
            });
        };

        $(document).ready(initLegend);
    </script>
</head>

<body class='default'>
    <div id="header">
        <h2>Flot cursors and cursor legend</h2>
    </div>
    <div id="content">
        <div class="demo-container">
            <div id="placeholder" class="demo-placeholder"></div>
        </div>
        <div id='jqxWidget' style="margin-left: 15px;">
            <div id="jqxgrid"></div>
            <div style="margin-top: 10px;">
                <div id="cellbegineditevent"></div>
                <div style="margin-top: 10px;" id="cellendeditevent"></div>
            </div>
            <div id="popupWindow">
                <div>Edit</div>
                <div style="overflow: hidden;">
                    <table>
                        <tr>
                            <td align="right">Cursor Name:</td>
                            <td align="left">
                                <input id="cursorname" />
                            </td>
                        </tr>
                        <tr>
                            <td align="right"></td>
                            <td style="padding-top: 10px;" align="right">
                                <input style="margin-right: 5px;" type="button" id="Save" value="Save" />
                                <input id="Cancel" type="button" value="Cancel" />
                            </td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id='Menu'>
                <ul>
                    <li>Edit Selected Cursor</li>
                    <li>Delete Selected Cursor</li>
                    <li>Add Cursor</li>
                </ul>
            </div>
        </div>
        <p>
            <input id="checkbox" type="checkbox" name="Dynamic data" value="0" checked>Dynamic chart data
        </p>
        <p>This is an example of how you can use jqWidgets to create a cursors legend. Right click on the cursor legend to add, edit delete cursors</p>
    </div>
</body>

</html>
